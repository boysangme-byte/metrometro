<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Steamline: ì„œìš¸ ì§€í•˜ì²  ìŠ¤íŒ€í‘í¬ ë¦´ë ˆì´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- ì›¹í°íŠ¸ (ì„ íƒ) -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #070b12;
      --bg-panel: #15151c;
      --accent-brass: #c69c6d;
      --accent-brass-soft: #b28850;
      --accent-danger: #ff4d4d;
      --accent-safe: #66ffcc;
      --text-main: #f5f5f5;
      --text-sub: #a9a9b8;
      --border-brass: rgba(198,156,109,0.9);
      --shadow-soft: 0 0 24px rgba(0,0,0,0.65);
      --radius-xl: 22px;
      --transition-fast: 0.18s ease-out;
      --transition-med: 0.28s ease-out;
      --font-ui: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-ui);
      background:
        radial-gradient(circle at top left, rgba(198,156,109,0.12), transparent),
        radial-gradient(circle at bottom right, rgba(102,255,204,0.06), transparent),
        #02040a;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 18px;
    }

    .game-shell {
      width: 100%;
      max-width: 1280px;
      margin: auto;
      background:
        radial-gradient(circle at top, rgba(198,156,109,0.06), transparent),
        rgba(4,6,12,0.98);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(198,156,109,0.35);
      box-shadow:
        0 0 40px rgba(0,0,0,0.9),
        inset 0 0 24px rgba(0,0,0,0.8);
      padding: 18px 18px 16px;
      position: relative;
      overflow: hidden;
    }

    .game-shell::before,
    .game-shell::after {
      content: "âš™";
      position: absolute;
      font-size: 80px;
      color: rgba(198,156,109,0.15);
      top: -20px;
      right: -10px;
      pointer-events: none;
      animation: gearRotateShell 12s linear infinite;
    }
    .game-shell::after {
      font-size: 50px;
      top: 30px;
      right: 50px;
      animation: gearRotateShell 8s linear infinite reverse;
    }

    @keyframes gearRotateShell {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .title-block {
      flex: 1;
    }

    .game-title {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: var(--accent-brass);
      text-shadow: 
        0 0 15px rgba(198,156,109,0.6),
        0 0 30px rgba(198,156,109,0.3);
      display: flex;
      align-items: baseline;
      gap: 8px;
      position: relative;
      animation: titleGlow 3s ease-in-out infinite;
    }

    @keyframes titleGlow {
      0%, 100% { text-shadow: 0 0 15px rgba(198,156,109,0.6), 0 0 30px rgba(198,156,109,0.3); }
      50% { text-shadow: 0 0 25px rgba(198,156,109,0.9), 0 0 50px rgba(198,156,109,0.5); }
    }

    .game-subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 3px;
    }

    .mode-controls {
      display: flex;
      gap: 8px;
      align-items: stretch;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 10px;
      color: var(--accent-brass-soft);
    }

    .select-steam {
      background: radial-gradient(circle at top, #27211c, #0b0b10);
      border-radius: 999px;
      border: 1px solid var(--border-brass);
      padding: 5px 10px;
      color: var(--text-main);
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-soft);
    }

    .select-steam select {
      background: transparent;
      border: none;
      color: var(--accent-brass);
      font-size: 12px;
      outline: none;
      padding-right: 4px;
      appearance: none;
      cursor: pointer;
    }

    .select-steam span.label {
      color: var(--text-sub);
      font-size: 10px;
      opacity: 0.85;
    }

    .mode-tabs {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .mode-tab {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(198,156,109,0.45);
      font-size: 9px;
      color: var(--accent-brass-soft);
      cursor: pointer;
      opacity: 0.6;
      transition: all var(--transition-fast);
      backdrop-filter: blur(2px);
    }

    .mode-tab.active {
      background: linear-gradient(to right, rgba(198,156,109,0.35), rgba(4,6,12,0.9));
      color: var(--text-main);
      opacity: 1;
      box-shadow: 0 0 10px rgba(198,156,109,0.35);
    }

    .mode-tab:hover {
      opacity: 0.95;
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(220px, 1.35fr);
      gap: 12px;
      margin-top: 4px;
      align-items: stretch;
    }

    .panel {
      background: 
        radial-gradient(circle at top left, rgba(198,156,109,0.08), transparent),
        radial-gradient(circle at bottom right, rgba(102,255,204,0.04), transparent),
        rgba(7,7,11,0.98);
      border-radius: 18px;
      padding: 12px;
      border: 2px solid rgba(198,156,109,0.4);
      box-shadow: 
        0 0 30px rgba(198,156,109,0.2),
        inset 0 0 20px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(198,156,109,0.6), 
        transparent
      );
      animation: steamFlow 3s ease-in-out infinite;
    }

    @keyframes steamFlow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.8; }
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 6px;
    }

    .panel-title {
      font-size: 12px;
      color: var(--accent-brass);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-title span.icon {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 1px solid rgba(198,156,109,0.55);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      color: var(--accent-brass);
    }

    .status-label {
      font-size: 9px;
      color: var(--text-sub);
      opacity: 0.9;
    }

    .log-window {
      height: 200px;
      overflow-y: auto;
      padding: 10px;
      font-size: 12px;
      line-height: 1.6;
      background: 
        radial-gradient(circle at top, rgba(10,10,14,1), rgba(3,4,7,1)),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 20px,
          rgba(198,156,109,0.02) 20px,
          rgba(198,156,109,0.02) 21px
        );
      border-radius: 12px;
      border: 2px solid rgba(198,156,109,0.3);
      box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
    }

    .log-entry {
      margin-bottom: 4px;
      display: flex;
      gap: 6px;
      align-items: baseline;
      animation: logSlideIn 0.3s ease;
    }

    @keyframes logSlideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .log-entry.combo {
      animation: comboFlash 0.6s ease;
    }

    @keyframes comboFlash {
      0%, 100% { background: transparent; }
      50% { background: rgba(198,156,109,0.2); }
    }

    .log-label {
      font-size: 9px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid rgba(198,156,109,0.33);
      color: var(--accent-brass-soft);
      min-width: 40px;
      text-align: center;
      flex-shrink: 0;
    }

    .log-label.ai {
      color: #ffb347;
      border-color: rgba(255,179,71,0.5);
    }

    .log-label.sys {
      color: var(--accent-safe);
      border-color: rgba(102,255,204,0.6);
    }

    .log-text {
      color: var(--text-main);
    }

    .hint-text {
      font-size: 9px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .input-area {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .input-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .station-input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 14px;
      border: 2px solid rgba(198,156,109,0.5);
      background: linear-gradient(135deg, #0a0b10, #05060a);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      box-shadow: 
        inset 0 0 15px rgba(0,0,0,0.8),
        0 0 10px rgba(198,156,109,0.1);
      transition: all 0.3s ease;
    }

    .station-input:focus {
      border-color: var(--accent-brass);
      box-shadow:
        0 0 20px rgba(198,156,109,0.5),
        inset 0 0 15px rgba(0,0,0,1);
      transform: scale(1.02);
    }

    .station-input::placeholder {
      color: rgba(198,156,109,0.4);
    }

    .btn {
      padding: 6px 10px;
      border-radius: 14px;
      border: 1px solid rgba(198,156,109,0.6);
      background: radial-gradient(circle at top, #3a2b20, #080809);
      color: var(--accent-brass);
      font-size: 10px;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .btn span.icon {
      font-size: 11px;
    }

    .btn:hover {
      background: radial-gradient(circle at top, #463222, #050509);
      color: var(--text-main);
      box-shadow: 0 0 20px rgba(198,156,109,0.6);
      transform: translateY(-2px) scale(1.05);
      transition: all 0.2s ease;
    }

    .btn:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-success {
      animation: successPulse 0.5s ease;
    }

    @keyframes successPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); box-shadow: 0 0 25px rgba(102,255,204,0.8); }
      100% { transform: scale(1); }
    }

    .btn-error {
      animation: errorShake 0.5s ease;
    }

    @keyframes errorShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .btn-ghost {
      background: transparent;
      border-style: dashed;
      opacity: 0.65;
    }

    .btn-ghost:hover {
      opacity: 1;
      background: rgba(198,156,109,0.08);
    }

    .timer-bar-wrap {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(198,156,109,0.5);
      overflow: hidden;
      background: #050609;
      position: relative;
    }

    .timer-bar-fill {
      height: 100%;
      width: 100%;
      background: linear-gradient(to right, var(--accent-safe), #ffd54a, var(--accent-danger));
      transform-origin: left center;
      transition: transform 0.2s linear;
      position: relative;
      overflow: hidden;
    }

    .timer-bar-fill::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255,255,255,0.3), 
        transparent
      );
      animation: timerShine 2s ease-in-out infinite;
    }

    @keyframes timerShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .timer-label {
      font-size: 9px;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .stats {
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
      font-size: 9px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .stat-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 2px solid rgba(198,156,109,0.4);
      background: radial-gradient(circle, rgba(198,156,109,0.1), transparent);
      display: inline-flex;
      gap: 5px;
      align-items: center;
      box-shadow: 0 0 10px rgba(198,156,109,0.2);
      transition: all 0.3s ease;
    }

    .stat-pill:hover {
      border-color: rgba(198,156,109,0.6);
      box-shadow: 0 0 15px rgba(198,156,109,0.4);
      transform: translateY(-1px);
    }

    .stat-label {
      color: var(--accent-brass-soft);
    }

    .stat-value {
      color: var(--accent-safe);
      font-weight: 600;
      font-size: 11px;
      text-shadow: 0 0 8px rgba(102,255,204,0.5);
      transition: all 0.3s ease;
    }

    .stat-value.updated {
      animation: statUpdate 0.5s ease;
    }

    @keyframes statUpdate {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); color: #fff; }
    }

    .combo-display {
      position: relative;
    }

    .combo-display.active::after {
      content: "ğŸ”¥";
      position: absolute;
      right: -15px;
      animation: firePulse 0.5s ease infinite;
    }

    @keyframes firePulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    /* ìš°ì¸¡: AI / ì  / ì •ë³´ íŒ¨ë„ */

    .enemy-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 8px;
    }

    .enemy-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      padding: 16px;
      border-radius: 20px;
      background: 
        radial-gradient(circle at center, rgba(198,156,109,0.12), transparent),
        radial-gradient(circle at top left, rgba(198,156,109,0.08), transparent),
        #050609;
      border: 2px solid rgba(198,156,109,0.5);
      box-shadow: 
        0 0 40px rgba(198,156,109,0.3),
        inset 0 0 30px rgba(0,0,0,0.6);
      position: relative;
      overflow: visible;
    }

    .enemy-card::after {
      content: "âš™";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      color: rgba(198,156,109,0.4);
      animation: gearSpin 4s linear infinite;
    }

    @keyframes gearSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .steam-effect {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: hidden;
      border-radius: 20px;
    }

    .steam-effect::before,
    .steam-effect::after {
      content: "";
      position: absolute;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle, rgba(198,156,109,0.2), transparent);
      border-radius: 50%;
      animation: steamRise 6s ease-in-out infinite;
    }

    .steam-effect::before {
      left: 20%;
      animation-delay: 0s;
    }

    .steam-effect::after {
      right: 20%;
      animation-delay: 3s;
    }

    @keyframes steamRise {
      0% { transform: translateY(0) scale(0.8); opacity: 0.3; }
      50% { transform: translateY(-30px) scale(1.2); opacity: 0.6; }
      100% { transform: translateY(-60px) scale(1.5); opacity: 0; }
    }

    .enemy-avatar-wrap {
      width: 180px;
      height: 180px;
      border-radius: 24px;
      overflow: visible;
      border: 3px solid rgba(198,156,109,0.8);
      background: radial-gradient(circle, rgba(198,156,109,0.15), #010102);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      position: relative;
      box-shadow: 
        0 0 30px rgba(198,156,109,0.5),
        inset 0 0 20px rgba(0,0,0,0.8);
      animation: steamPulse 3s ease-in-out infinite;
    }

    @keyframes steamPulse {
      0%, 100% { box-shadow: 0 0 30px rgba(198,156,109,0.5), inset 0 0 20px rgba(0,0,0,0.8); }
      50% { box-shadow: 0 0 50px rgba(198,156,109,0.8), inset 0 0 20px rgba(0,0,0,0.8); }
    }

    .enemy-avatar-wrap::before {
      content: "";
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border: 2px dashed rgba(198,156,109,0.3);
      border-radius: 28px;
      animation: gearRotate 8s linear infinite;
    }

    @keyframes gearRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .enemy-avatar-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      filter: drop-shadow(0 0 10px rgba(198,156,109,0.6));
      animation: floatEnemy 4s ease-in-out infinite;
    }

    @keyframes floatEnemy {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }

    .enemy-info {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 6px;
      text-align: center;
    }

    .enemy-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-brass);
      text-shadow: 0 0 10px rgba(198,156,109,0.6);
      letter-spacing: 1px;
    }

    .enemy-role {
      font-size: 9px;
      color: var(--text-sub);
    }

    .enemy-quip {
      font-size: 9px;
      color: var(--accent-safe);
    }

    .enemy-diff {
      font-size: 8px;
      color: var(--accent-brass-soft);
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid rgba(198,156,109,0.35);
      align-self: flex-start;
      margin-top: 1px;
    }

    .info-panel {
      flex: 1;
      padding: 6px;
      background: radial-gradient(circle at top, rgba(198,156,109,0.04), transparent),
                  #050609;
      border-radius: 14px;
      border: 1px solid rgba(198,156,109,0.25);
      font-size: 9px;
      color: var(--text-sub);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .info-panel strong {
      color: var(--accent-brass-soft);
      font-weight: 500;
    }

    .info-list {
      list-style: none;
      padding-left: 10px;
      margin: 0;
      display: grid;
      gap: 2px;
    }

    .info-list li::before {
      content: "âš™";
      font-size: 7px;
      margin-right: 4px;
      color: rgba(198,156,109,0.7);
    }



    /* ìŠ¤í¬ë¡¤ë°” */
    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }
    ::-webkit-scrollbar-track {
      background: #050509;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(198,156,109,0.38);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(198,156,109,0.6);
    }

    @media (max-width: 840px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      .enemy-card {
        order: -1;
      }
    }
  </style>
</head>
<body>
<div class="game-shell">
  <div class="header">
    <div class="title-block">
      <div class="game-title">
        <span>âš™ Steamline âš™</span>
        <span style="font-size:14px; color:#f5f5f5;">ì„œìš¸ ì§€í•˜ì²  ìŠ¤íŒ€í‘í¬ ë¦´ë ˆì´</span>
      </div>
      <div class="game-subtitle">
        í˜¸ì„  ì„ íƒ â†’ ë‚œì´ë„ ì„¤ì • â†’ ì—­ ì´ë¦„ì„ ë¦´ë ˆì´ë¡œ ì…ë ¥í•˜ì„¸ìš”. AI ìŠ¤íŒ€ ì§ìŠ¹ë“¤ê³¼ì˜ ë‘ë‡Œ ì‹¸ì›€ì—ì„œ ì‚´ì•„ë‚¨ìœ¼ë©´ ìŠ¹ë¦¬ì…ë‹ˆë‹¤.
      </div>
    </div>

    <div class="mode-controls">
      <div class="control-group">
        <div class="select-steam">
          <span class="label">í˜¸ì„ </span>
          <select id="lineSelect">
            <option value="1">1í˜¸ì„ </option>
            <option value="2" selected>2í˜¸ì„ </option>
            <option value="3">3í˜¸ì„ </option>
            <option value="4">4í˜¸ì„ </option>
            <option value="5">5í˜¸ì„ </option>
            <option value="6">6í˜¸ì„ </option>
            <option value="7">7í˜¸ì„ </option>
            <option value="8">8í˜¸ì„ </option>
            <option value="9">9í˜¸ì„ </option>
          </select>
        </div>
      </div>
      <div class="control-group">
        <div class="select-steam">
          <span class="label">ë‚œì´ë„</span>
          <select id="difficultySelect">
            <option value="easy">ì´ˆê¸‰</option>
            <option value="normal" selected>ì¤‘ê¸‰</option>
            <option value="hard">ê³ ê¸‰</option>
            <option value="master">ë§ˆìŠ¤í„°</option>
          </select>
        </div>
      </div>
      <div class="control-group">
        <div class="mode-tabs">
          <div class="mode-tab active" data-mode="time">íƒ€ì„ì–´íƒ</div>
          <div class="mode-tab" data-mode="rush">ëœë¤ ëŸ¬ì‹œ</div>
        </div>
      </div>
      <button class="btn btn-ghost" id="resetGameBtn" title="ìƒˆ ê²Œì„">
        <span class="icon">â†»</span> ë¦¬ë¶“
      </button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ì¢Œì¸¡: ë©”ì¸ ê²Œì„ íŒ¨ë„ -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="icon">âš™</span>
          <span id="panelTitleText">íƒ€ì„ì–´íƒ ëª¨ë“œ ì§„í–‰ì¤‘</span>
        </div>
        <div class="status-label" id="statusLabel">í”Œë ˆì´ì–´ë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤.</div>
      </div>

      <div class="log-window" id="logWindow"></div>

      <div class="input-area">
        <div class="input-row">
          <input
            id="stationInput"
            class="station-input"
            type="text"
            placeholder="ë‹¹ì‹ ì˜ ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ) í™ëŒ€ì…êµ¬"
            autocomplete="off"
          />
          <button class="btn" id="submitBtn">
            <span class="icon">â–¶</span> ì œì¶œ
          </button>
          <button class="btn btn-ghost" id="hintBtn">
            <span class="icon">?</span> íŒíŠ¸
          </button>
        </div>
        <div class="timer-bar-wrap">
          <div class="timer-bar-fill" id="timerBar"></div>
        </div>
        <div class="timer-label">
          <span id="timerText">ë‚¨ì€ ì‹œê°„: --ì´ˆ</span>
          <span id="turnText">í˜„ì¬ í„´: í”Œë ˆì´ì–´</span>
        </div>
        <div class="stats">
          <div class="stat-pill">
            <span class="stat-label">í”Œë ˆì´ì–´ ì ìˆ˜</span>
            <span class="stat-value" id="playerScore">0</span>
          </div>
          <div class="stat-pill">
            <span class="stat-label">AI ì ìˆ˜</span>
            <span class="stat-value" id="aiScore">0</span>
          </div>
          <div class="stat-pill">
            <span class="stat-label">ì½¤ë³´</span>
            <span class="stat-value" id="comboCount">0</span>
          </div>
          <div class="stat-pill">
            <span class="stat-label">ë‚¨ì€ ëª©ìˆ¨</span>
            <span class="stat-value" id="lives">3</span>
          </div>
          <div class="stat-pill">
            <span class="stat-label">ì‚¬ìš©í•œ ì—­</span>
            <span class="stat-value" id="usedCount">0</span>
          </div>
        </div>
        <div class="hint-text" id="hintText">
          ë‚œì´ë„ì™€ ëª¨ë“œì— ë”°ë¼ í—ˆìš©ë˜ëŠ” ì—­ ì¡°ê±´ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. (ì´ˆê¸‰: ëŒ€í‘œì—­ ìœ„ì£¼, ë§ˆìŠ¤í„°: ì‹¤ì œ ì¸ì ‘ì—­ë§Œ ê°€ëŠ¥)
        </div>
      </div>

    </div>

    <!-- ìš°ì¸¡: AI/ì /ì •ë³´ íŒ¨ë„ -->
    <div class="enemy-panel">
      <div class="enemy-card">
        <div class="steam-effect"></div>
        <div class="enemy-avatar-wrap">
          <img id="enemyAvatar" src="enemy-cat.png" alt="Steam AI Enemy">
        </div>
        <div class="enemy-info">
          <div class="enemy-name" id="enemyName">âš™ ë³¼íŠ¸ ìº£ : ë¼ì¸ íŒŒê´´ì âš™</div>
          <div class="enemy-role" id="enemyRole">
            âš¡ ì¦ê¸° ê¸°ê´€ìœ¼ë¡œ ì›€ì§ì´ëŠ” ê¸°ê³„ ìƒëª…ì²´. ì§€í•˜ì²  ë…¸ì„ ì„ ì™„ë²½íˆ ê¸°ì–µí•˜ëŠ” ìŠ¤íŒ€í‘í¬ AIì…ë‹ˆë‹¤.
          </div>
          <div class="enemy-quip" id="enemyQuip">
            "ë„¤ê°€ ëª¨ë¥´ëŠ” í™˜ìŠ¹ì—­ì€, ë‚´ê°€ ì‚¬ëŠ”å·¢ì•¼."
          </div>
          <div class="enemy-diff" id="enemyDiff">âš¡ ì¤‘ê¸‰ AI âš¡</div>
        </div>
      </div>

      <div class="info-panel">
        <div><strong>ë‚œì´ë„ ê·œì¹™ ìš”ì•½</strong></div>
        <ul class="info-list" id="difficultyInfoList">
          <li>ì´ˆê¸‰: ëŒ€í‘œì—­ë§Œ í—ˆìš©, ì—¬ìœ  ìˆëŠ” ì‹œê°„ ì œí•œ, íŒíŠ¸ ì ê·¹ ì œê³µ.</li>
          <li>ì¤‘ê¸‰: í•´ë‹¹ í˜¸ì„  ì „ì²´ ì—­, ì¤‘ë³µ ì‹œ íŒ¨ë„í‹°.</li>
          <li>ê³ ê¸‰: í™˜ìŠ¹ì—­ ì½¤ë³´ ì‹œìŠ¤í…œ. í™˜ìŠ¹ì—­ ì…ë ¥ ì‹œ ë³´ë„ˆìŠ¤ & ë‹¤ìŒ í„´ ë¼ì¸ ì²´ì¸.</li>
          <li>ë§ˆìŠ¤í„°: ì¸ì ‘ì—­ ë¦´ë ˆì´. í•œ ë²ˆì˜ ì‹¤ìˆ˜ê°€ ì¹˜ëª…ì .</li>
        </ul>

        <div><strong>ëª¨ë“œ ì„¤ëª…</strong></div>
        <ul class="info-list">
          <li>íƒ€ì„ì–´íƒ: ì œí•œ ì‹œê°„ ë™ì•ˆ ìµœëŒ€í•œ ë§ì€ ì—­ì„ ì…ë ¥í•˜ì„¸ìš”!</li>
          <li>ëœë¤ ëŸ¬ì‹œ: ë§¤ í„´ í˜¸ì„ ì´ ëœë¤ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
  /********************************************************************
   * ì„œìš¸ ì§€í•˜ì²  ì—­ ë°ì´í„° (ìš”ì•½ ë²„ì „)
   * - ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œ, ì„œìš¸êµí†µê³µì‚¬ / ìœ„í‚¤ë°±ê³¼ ë“± ê³µì‹ ìë£Œë¥¼ ì°¸ê³ í•´
   *   ì „ì²´ ì—­ ëª©ë¡ & í™˜ìŠ¹ ì •ë³´ë¡œ í™•ì¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
   *   (ì—¬ê¸°ì„œëŠ” ê²Œì„ ë°ëª¨ìš©ìœ¼ë¡œ ëŒ€í‘œ êµ¬ê°„ ìœ„ì£¼ êµ¬ì„±)
   ********************************************************************/

  const SUBWAY_DATA = {
    "1": {
      name: "1í˜¸ì„ ",
      basic: ["ì„œìš¸ì—­","ì‹œì²­","ì¢…ê°","ì¢…ë¡œ3ê°€","ì¢…ë¡œ5ê°€","ë™ëŒ€ë¬¸","ì²­ëŸ‰ë¦¬","ì‹ ì„¤ë™","ìš©ì‚°","ë…¸ëŸ‰ì§„","ëŒ€ë°©","ì‹ ê¸¸","ì˜ë“±í¬","êµ¬ë¡œ","ë¶€ì²œ","ì†Œì‚¬","ì¸ì²œ"],
      all: [
        "ì†Œìš”ì‚°","ë™ë‘ì²œ","ë³´ì‚°","ë™ë‘ì²œì¤‘ì•™","ì§€í–‰","ë•ì •","ë•ê³„","ì–‘ì£¼","ë…¹ì–‘","ê°€ëŠ¥","ì˜ì •ë¶€",
        "íšŒë£¡","ë§ì›”ì‚¬","ë„ë´‰ì‚°","ë„ë´‰","ë°©í•™","ì°½ë™","ë…¹ì²œ","ì›”ê³„","ê´‘ìš´ëŒ€","ì„ê³„","ì‹ ì´ë¬¸","ì™¸ëŒ€ì•",
        "íšŒê¸°","ì²­ëŸ‰ë¦¬","ì œê¸°ë™","ì‹ ì„¤ë™","ë™ë¬˜ì•","ë™ëŒ€ë¬¸","ì¢…ë¡œ5ê°€","ì¢…ë¡œ3ê°€","ì¢…ê°","ì‹œì²­","ì„œìš¸ì—­",
        "ë‚¨ì˜","ìš©ì‚°","ë…¸ëŸ‰ì§„","ëŒ€ë°©","ì‹ ê¸¸","ì˜ë“±í¬","ì‹ ë„ë¦¼","êµ¬ë¡œ","ê°€ì‚°ë””ì§€í„¸ë‹¨ì§€","ë…ì‚°","ê¸ˆì²œêµ¬ì²­","ì„ìˆ˜","ê´€ì•…","ì•ˆì–‘","ëª…í•™","ê¸ˆì •","êµ°í¬","ë‹¹ì •","ì˜ì™•","ì„±ê· ê´€ëŒ€","í™”ì„œ","ìˆ˜ì›","ì„¸ë¥˜","ë³‘ì ","ì„¸ë§ˆ","ì˜¤ì‚°ëŒ€","ì˜¤ì‚°","ì§„ìœ„","ì†¡íƒ„","ì„œì •ë¦¬","í‰íƒì§€ì œ","í‰íƒ","ì„±í™˜","ì§ì‚°","ë‘ì •","ì²œì•ˆ","ë´‰ëª…","ìŒìš©","ì•„ì‚°","íƒ•ì •","ë°°ë°©","ì˜¨ì–‘ì˜¨ì²œ","ì‹ ì°½",
        "ì¸ì²œ","ë™ì¸ì²œ","ì£¼ì•ˆ","ë„í™”","ì œë¬¼í¬","ë„ì›","ë™ì•”","ë°±ìš´","ë¶€í‰","ë¶€ê°œ","ì†¡ë‚´","ì¤‘ë™","ë¶€ì²œ","ì†Œì‚¬","ì—­ê³¡","ì˜¨ìˆ˜","ì˜¤ë¥˜ë™","ê°œë´‰","êµ¬ì¼"
      ]
    },
    "2": {
      name: "2í˜¸ì„ ",
      basic: ["ì‹œì²­","ì„ì§€ë¡œì…êµ¬","ì„ì§€ë¡œ3ê°€","ì„ì§€ë¡œ4ê°€","ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›","ì™•ì‹­ë¦¬","ê±´ëŒ€ì…êµ¬","ì ì‹¤","ê°•ë‚¨","êµëŒ€","ì„œìš¸ëŒ€ì…êµ¬","ì‹ ë„ë¦¼","ë¬¸ë˜","ì˜ë“±í¬êµ¬ì²­","í•©ì •","í™ëŒ€ì…êµ¬","ì‹ ì´Œ","ì´ëŒ€"],
      all: [
        "ì‹œì²­","ì„ì§€ë¡œì…êµ¬","ì„ì§€ë¡œ3ê°€","ì„ì§€ë¡œ4ê°€","ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›","ì‹ ë‹¹","ìƒì™•ì‹­ë¦¬","ì™•ì‹­ë¦¬","í•œì–‘ëŒ€",
        "ëšì„¬","ì„±ìˆ˜","ê±´ëŒ€ì…êµ¬","êµ¬ì˜","ê°•ë³€","ì ì‹¤ë‚˜ë£¨","ì ì‹¤","ì‹ ì²œ","ì¢…í•©ìš´ë™ì¥","ì‚¼ì„±","ì„ ë¦‰","ì—­ì‚¼",
        "ê°•ë‚¨","êµëŒ€","ì„œì´ˆ","ë°©ë°°","ì‚¬ë‹¹","ë‚™ì„±ëŒ€","ì„œìš¸ëŒ€ì…êµ¬","ë´‰ì²œ","ì‹ ë¦¼","ì‹ ëŒ€ë°©","êµ¬ë¡œë””ì§€í„¸ë‹¨ì§€",
        "ëŒ€ë¦¼","ì‹ ë„ë¦¼","ë¬¸ë˜","ì˜ë“±í¬êµ¬ì²­","ë‹¹ì‚°","í•©ì •","í™ëŒ€ì…êµ¬","ì‹ ì´Œ","ì´ëŒ€","ì•„í˜„","ì¶©ì •ë¡œ",
        "ê¹Œì¹˜ì‚°","ì‹ ì •ë„¤ê±°ë¦¬","ì–‘ì²œêµ¬ì²­","ë„ë¦¼ì²œ"
      ]
    },
    "3": {
      name: "3í˜¸ì„ ",
      basic: ["ëŒ€í™”","ì£¼ì—½","ì •ë°œì‚°","ë§ˆë‘","ë°±ì„","ëŒ€ê³¡","ì—°ì‹ ë‚´","ë¶ˆê´‘","ê²½ë³µê¶","ì•ˆêµ­","ì¢…ë¡œ3ê°€","ì„ì§€ë¡œ3ê°€","ì¶©ë¬´ë¡œ","êµëŒ€","ì–‘ì¬","ìˆ˜ì„œ"],
      all: [
        "ëŒ€í™”","ì£¼ì—½","ì •ë°œì‚°","ë§ˆë‘","ë°±ì„","ëŒ€ê³¡","í™”ì •","ì›ë‹¹","ì›í¥","ì‚¼ì†¡","ì§€ì¶•","êµ¬íŒŒë°œ","ì—°ì‹ ë‚´","ë¶ˆê´‘","ë…¹ë²ˆ","í™ì œ","ë¬´ì•…ì¬",
        "ë…ë¦½ë¬¸","ê²½ë³µê¶","ì•ˆêµ­","ì¢…ë¡œ3ê°€","ì¶©ë¬´ë¡œ","ë™ëŒ€ì…êµ¬","ì•½ìˆ˜","ê¸ˆí˜¸","ì˜¥ìˆ˜","ì••êµ¬ì •","ì‹ ì‚¬","ì ì›","ê³ ì†í„°ë¯¸ë„",
        "êµëŒ€","ë‚¨ë¶€í„°ë¯¸ë„","ì–‘ì¬","ë§¤ë´‰","ë„ê³¡","ëŒ€ì¹˜","í•™ì—¬ìš¸","ëŒ€ì²­","ì¼ì›","ìˆ˜ì„œ","ê°€ë½ì‹œì¥","ê²½ì°°ë³‘ì›","ì˜¤ê¸ˆ"
      ]
    },
    "4": {
      name: "4í˜¸ì„ ",
      basic: ["ë‹¹ê³ ê°œ","ë…¸ì›","ì°½ë™","ìˆ˜ìœ ","ë¯¸ì•„ì‚¬ê±°ë¦¬","ì„±ì‹ ì—¬ëŒ€ì…êµ¬","í˜œí™”","ë™ëŒ€ë¬¸","ì¶©ë¬´ë¡œ","ëª…ë™","ì„œìš¸ì—­","ìˆ™ëŒ€ì…êµ¬","ì‚¼ê°ì§€","ì´ì´Œ","ë™ì‘","ì‚¬ë‹¹","ê¸ˆì •"],
      all: [
        "ë‹¹ê³ ê°œ","ìƒê³„","ë…¸ì›","ì°½ë™","ìŒë¬¸","ìˆ˜ìœ ","ë¯¸ì•„","ë¯¸ì•„ì‚¬ê±°ë¦¬","ê¸¸ìŒ","ì„±ì‹ ì—¬ëŒ€ì…êµ¬",
        "í•œì„±ëŒ€ì…êµ¬","í˜œí™”","ë™ëŒ€ë¬¸","ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›","ì¶©ë¬´ë¡œ","ëª…ë™","íšŒí˜„","ì„œìš¸ì—­",
        "ìˆ™ëŒ€ì…êµ¬","ì‚¼ê°ì§€","ì‹ ìš©ì‚°","ì´ì´Œ","ë™ì‘","ì´ì‹ ëŒ€ì…êµ¬","ì‚¬ë‹¹","ë‚¨íƒœë ¹","ì„ ë°”ìœ„","ê²½ë§ˆê³µì›","ëŒ€ê³µì›",
        "ê³¼ì²œ","ì •ë¶€ê³¼ì²œì²­ì‚¬","ì¸ë•ì›","í‰ì´Œ","ë²”ê³„","ê¸ˆì •","ì‚°ë³¸","ìˆ˜ë¦¬ì‚°","ëŒ€ì•¼ë¯¸","ë°˜ì›”","ìƒë¡ìˆ˜","í•œëŒ€ì•","ì¤‘ì•™","ê³ ì”","ì´ˆì§€","ì•ˆì‚°","ì‹ ê¸¸ì˜¨ì²œ","ì •ì™•","ì˜¤ì´ë„"
      ]
    },
    "5": {
      name: "5í˜¸ì„ ",
      basic: ["ë°©í™”","ê¹€í¬ê³µí•­","ì—¬ì˜ë„","ê³µë•","ì¶©ì •ë¡œ","ê´‘í™”ë¬¸","ì¢…ë¡œ3ê°€","ì™•ì‹­ë¦¬","ì²œí˜¸","ë‘”ì´Œë™","ì˜¬ë¦¼í”½ê³µì›"],
      all: [
        "ë°©í™”","ê°œí™”ì‚°","ê¹€í¬ê³µí•­","ì†¡ì •","ë§ˆê³¡","ë°œì‚°","ìš°ì¥ì‚°","í™”ê³¡","ê¹Œì¹˜ì‚°","ì‹ ì •","ëª©ë™","ì˜¤ëª©êµ","ì–‘í‰",
        "ì˜ë“±í¬êµ¬ì²­","ì—¬ì˜ë„","ì—¬ì˜ë‚˜ë£¨","ë§ˆí¬","ê³µë•","ì• ì˜¤ê°œ","ì¶©ì •ë¡œ","ì„œëŒ€ë¬¸","ê´‘í™”ë¬¸","ì¢…ë¡œ3ê°€",
        "ì„ì§€ë¡œ4ê°€","ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›","ì²­êµ¬","ì‹ ê¸ˆí˜¸","í–‰ë‹¹","ì™•ì‹­ë¦¬","ë§ˆì¥","ë‹µì‹­ë¦¬","ì¥í•œí‰","êµ°ì","ì•„ì°¨ì‚°",
        "ê´‘ë‚˜ë£¨","ì²œí˜¸","ê°•ë™","ê¸¸ë™","êµ½ì€ë‹¤ë¦¬","ëª…ì¼","ê³ ë•","ìƒì¼ë™","ë‘”ì´Œë™","ì˜¬ë¦¼í”½ê³µì›","ë°©ì´","ê°œë¡±","ê±°ì—¬","ë§ˆì²œ"
      ]
    },
    "6": {
      name: "6í˜¸ì„ ",
      basic: ["ì‘ì•”","ë¶ˆê´‘","ì—°ì‹ ë‚´","ë””ì§€í„¸ë¯¸ë””ì–´ì‹œí‹°","ë§ˆí¬êµ¬ì²­","ëŒ€í¥","ê³µë•","ì‚¼ê°ì§€","ì´íƒœì›","í•œê°•ì§„"],
      all: [
        "ì‘ì•”","ì—­ì´Œ","ë¶ˆê´‘","ë…ë°”ìœ„","ì—°ì‹ ë‚´","êµ¬ì‚°","ìƒˆì ˆ","ì¦ì‚°","ë””ì§€í„¸ë¯¸ë””ì–´ì‹œí‹°","ì›”ë“œì»µê²½ê¸°ì¥","ë§ˆí¬êµ¬ì²­",
        "ë§ì›","í•©ì •","ìƒìˆ˜","ê´‘í¥ì°½","ëŒ€í¥","ê³µë•","íš¨ì°½ê³µì›ì•","ì‚¼ê°ì§€","ë…¹ì‚¬í‰","ì´íƒœì›","í•œê°•ì§„","ë²„í‹°ê³ ê°œ",
        "ì•½ìˆ˜","ì²­êµ¬","ì‹ ë‹¹","ë™ë¬˜ì•","ì°½ì‹ ","ë³´ë¬¸","ì•ˆì•”","ê³ ë ¤ëŒ€","ì›”ê³¡","ìƒì›”ê³¡","ëŒê³¶ì´","ì„ê³„","íƒœë¦‰ì…êµ¬",
        "í™”ë‘ëŒ€","ë´‰í™”ì‚°","ì‹ ë‚´"
      ]
    },
    "7": {
      name: "7í˜¸ì„ ",
      basic: ["ì¥ì•”","ë„ë´‰ì‚°","ë…¸ì›","ê±´ëŒ€ì…êµ¬","êµ°ì","ê³ ì†í„°ë¯¸ë„","ë‚´ë°©"],
      all: [
        "ì¥ì•”","ë„ë´‰ì‚°","ìˆ˜ë½ì‚°","ë§ˆë“¤","ë…¸ì›","ì¤‘ê³„","í•˜ê³„","ê³µë¦‰","íƒœë¦‰ì…êµ¬","ë¨¹ê³¨","ì¤‘í™”","ìƒë´‰","ë©´ëª©",
        "ì‚¬ê°€ì •","ìš©ë§ˆì‚°","ì¤‘ê³¡","êµ°ì","ì–´ë¦°ì´ëŒ€ê³µì›","ê±´ëŒ€ì…êµ¬","ëšì„¬ìœ ì›ì§€","ì²­ë‹´","ê°•ë‚¨êµ¬ì²­","í•™ë™","ë…¼í˜„",
        "ë°˜í¬","ê³ ì†í„°ë¯¸ë„","ë‚´ë°©","ì´ìˆ˜","ë‚¨ì„±","ìˆ­ì‹¤ëŒ€ì…êµ¬","ìƒë„","ì¥ìŠ¹ë°°ê¸°","ì‹ ëŒ€ë°©ì‚¼ê±°ë¦¬","ë³´ë¼ë§¤","ì‹ í’",
        "ëŒ€ë¦¼","ë‚¨êµ¬ë¡œ","ê°€ì‚°ë””ì§€í„¸ë‹¨ì§€","ì² ì‚°","ê´‘ëª…ì‚¬ê±°ë¦¬","ì²œì™•","ì˜¨ìˆ˜"
      ]
    },
    "8": {
      name: "8í˜¸ì„ ",
      basic: ["ì•”ì‚¬","ì²œí˜¸","ì ì‹¤","ê°€ë½ì‹œì¥","ë³µì •","ëª¨ë€"],
      all: [
        "ì•”ì‚¬","ì²œí˜¸","ê°•ë™êµ¬ì²­","ëª½ì´Œí† ì„±","ì ì‹¤","ì„ì´Œ","ì†¡íŒŒ","ê°€ë½ì‹œì¥","ë¬¸ì •","ì¥ì§€","ë³µì •","ì‚°ì„±","ë‚¨í•œì‚°ì„±ì…êµ¬","ë‹¨ëŒ€ì˜¤ê±°ë¦¬","ì‹ í¥","ìˆ˜ì§„","ëª¨ë€"
      ]
    },
    "9": {
      name: "9í˜¸ì„ ",
      basic: ["ê°œí™”","ê¹€í¬ê³µí•­","ì—¼ì°½","ë‹¹ì‚°","ë…¸ëŸ‰ì§„","ë™ì‘","ê³ ì†í„°ë¯¸ë„","ì‹ ë…¼í˜„","ì¢…í•©ìš´ë™ì¥"],
      all: [
        "ê°œí™”","ê¹€í¬ê³µí•­","ê³µí•­ì‹œì¥","ì‹ ë°©í™”","ë§ˆê³¡ë‚˜ë£¨","ê°€ì–‘","ì¦ë¯¸","ë“±ì´Œ","ì—¼ì°½","ì‹ ëª©ë™","ì„ ìœ ë„",
        "ë‹¹ì‚°","êµ­íšŒì˜ì‚¬ë‹¹","ì—¬ì˜ë„","ìƒ›ê°•","ë…¸ëŸ‰ì§„","ë…¸ë“¤","í‘ì„","ë™ì‘","êµ¬ë°˜í¬","ì‹ ë°˜í¬","ê³ ì†í„°ë¯¸ë„",
        "ì‚¬í‰","ì‹ ë…¼í˜„","ì–¸ì£¼","ì„ ì •ë¦‰","ì‚¼ì„±ì¤‘ì•™","ë´‰ì€ì‚¬","ì¢…í•©ìš´ë™ì¥"
      ]
    }
  };

  // ë‚œì´ë„ & ì  ìºë¦­í„° ì •ì˜
  const DIFFICULTIES = {
    easy: {
      label: "ì´ˆê¸‰",
      timeLimit: 14,
      lives: 4,
      enableHints: true,
      comboTransfers: false,
      aiAccuracy: 0.25
    },
    normal: {
      label: "ì¤‘ê¸‰",
      timeLimit: 10,
      lives: 3,
      enableHints: true,
      comboTransfers: false,
      aiAccuracy: 0.92
    },
    hard: {
      label: "ê³ ê¸‰",
      timeLimit: 8,
      lives: 3,
      enableHints: true,
      comboTransfers: true,
      aiAccuracy: 0.97
    },
    master: {
      label: "ë§ˆìŠ¤í„°",
      timeLimit: 6,
      lives: 1,
      enableHints: false,
      comboTransfers: true,
      aiAccuracy: 0.995
    }
  };

  const ENEMIES = {
    easy: {
      name: "ê¸°ì–´ ë« : í†±ë‹ˆ ì¥ ì„œê¸°ê´€",
      img: "enemy-rat.png",
      diff: "ì´ˆê¸‰ AI",
      quip: "\"íˆíˆâ€¦ ëŒ€í‘œì—­ë§Œ ì™¸ì›Œë„ ì¶©ë¶„í•˜ê² ì§€?\""
    },
    normal: {
      name: "ë³¼íŠ¸ ìº£ : ë¼ì¸ íŒŒê´´ì",
      img: "enemy-cat.png",
      diff: "ì¤‘ê¸‰ AI",
      quip: "\"ì§€ê¸ˆë¶€í„° ì§„ì§œ ì§€ì‹ ì‹¸ì›€ì´ì•¼.\""
    },
    hard: {
      name: "ì•„ì´ì–¸ ë² ì–´ : í™˜ìŠ¹ í¬ì‹ì",
      img: "enemy-bear.png",
      diff: "ê³ ê¸‰ AI",
      quip: "\"í™˜ìŠ¹ì—­? ê·¸ê±´ ë‚´ ë°¥ì´ì§€.\""
    },
    master: {
      name: "ì„œí€íŠ¸ ë“œë¼ì´ë¸Œ : ë£¨íŠ¸ ì‹¬íŒì",
      img: "enemy-snake.png",
      diff: "ë§ˆìŠ¤í„° AI",
      quip: "\"ì¸ì ‘ì—­ì´ ì•„ë‹ˆë©´, ì¡´ì¬í•  ê°€ì¹˜ë„ ì—†ë‹¤.\""
    }
  };

  // ì¸ì ‘ ê´€ê³„ (ë§ˆìŠ¤í„° ë‚œì´ë„ìš©) - ì¼ë¶€ ë…¸ì„ /êµ¬ê°„ ì˜ˆì‹œ
  const ADJACENCY = {};
  function addAdjacency(lineKey, stations) {
    for (let i = 0; i < stations.length - 1; i++) {
      const a = stations[i], b = stations[i+1];
      if (!ADJACENCY[a]) ADJACENCY[a] = new Set();
      if (!ADJACENCY[b]) ADJACENCY[b] = new Set();
      ADJACENCY[a].add(b);
      ADJACENCY[b].add(a);
    }
  }
  Object.keys(SUBWAY_DATA).forEach(lineKey => {
    addAdjacency(lineKey, SUBWAY_DATA[lineKey].all);
  });

  // ì—­ â†’ í¬í•¨ í˜¸ì„  ë§µ (í™˜ìŠ¹ ì²´í¬ìš©)
  const STATION_LINES = {};
  Object.entries(SUBWAY_DATA).forEach(([lineKey, info]) => {
    info.all.forEach(st => {
      const key = normalizeStation(st);
      if (!STATION_LINES[key]) STATION_LINES[key] = new Set();
      STATION_LINES[key].add(lineKey);
    });
  });

  /********************************************************************
   * ê²Œì„ ìƒíƒœ
   ********************************************************************/
  const state = {
    mode: "time",
    line: "2",
    difficulty: "normal",
    turn: "player",
    used: new Set(),
    lastStation: null,
    playerScore: 0,
    aiScore: 0,
    combo: 0,
    lives: DIFFICULTIES["normal"].lives,
    timeLeft: DIFFICULTIES["normal"].timeLimit,
    timerId: null,
    chainLineLock: null // í™˜ìŠ¹ ì½¤ë³´ìš©
  };

  /********************************************************************
   * DOM - ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸ (ë‚˜ì¤‘ì— ì´ˆê¸°í™”)
   ********************************************************************/
  let el = {};

  /********************************************************************
   * ìœ í‹¸
   ********************************************************************/
  function normalizeStation(name) {
    if (!name) return "";
    return name
      .toString()
      .trim()
      .replace(/ì—­$/,"")
      .replace(/\s+/g,"")
      .toLowerCase();
  }
  
  // ë””ë²„ê¹…ìš©: ì—­ ê²€ì¦ í•¨ìˆ˜
  function debugValidateStation(input, lineKey) {
    const info = SUBWAY_DATA[lineKey];
    if (!info) return { found: false, reason: "í˜¸ì„  ì •ë³´ ì—†ìŒ" };
    
    const norm = normalizeStation(input);
    const allNormalized = info.all.map(s => normalizeStation(s));
    const basicNormalized = info.basic.map(s => normalizeStation(s));
    
    return {
      input: input,
      normalized: norm,
      inAll: allNormalized.includes(norm),
      inBasic: basicNormalized.includes(norm),
      allStations: info.all,
      normalizedAll: allNormalized
    };
  }

  function log(type, text) {
    const div = document.createElement("div");
    div.className = "log-entry";
    const label = document.createElement("div");
    label.className = "log-label " + (type === "ai" ? "ai" : (type === "sys" ? "sys" : ""));
    label.textContent = type === "player" ? "YOU" :
                        type === "ai" ? "AI" : "SYS";
    const span = document.createElement("div");
    span.className = "log-text";
    span.textContent = text;
    div.appendChild(label);
    div.appendChild(span);
    el.logWindow.appendChild(div);
    el.logWindow.scrollTop = el.logWindow.scrollHeight;
  }

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function resetTimer() {
    if (state.timerId) clearInterval(state.timerId);
    const cfg = DIFFICULTIES[state.difficulty];
    state.timeLeft = cfg.timeLimit;
    updateTimerUI();
    state.timerId = setInterval(() => {
      state.timeLeft--;
      updateTimerUI();
      if (state.timeLeft <= 0) {
        clearInterval(state.timerId);
        handleTimeout();
      }
    }, 1000);
  }

  function updateTimerUI() {
    const cfg = DIFFICULTIES[state.difficulty];
    const ratio = Math.max(0, Math.min(1, state.timeLeft / cfg.timeLimit));
    el.timerBar.style.transform = `scaleX(${ratio})`;
    el.timerText.textContent = `ë‚¨ì€ ì‹œê°„: ${state.timeLeft > 0 ? state.timeLeft : 0}ì´ˆ`;
    el.turnText.textContent = `í˜„ì¬ í„´: ${state.turn === "player" ? "í”Œë ˆì´ì–´" : "AI"}`;
  }

  function updateStats() {
    const playerScoreEl = el.playerScore;
    const aiScoreEl = el.aiScore;
    const comboEl = el.comboCount;
    
    if (playerScoreEl.textContent !== state.playerScore.toString()) {
      playerScoreEl.textContent = state.playerScore;
      playerScoreEl.classList.add("updated");
      setTimeout(() => playerScoreEl.classList.remove("updated"), 500);
    }
    
    if (aiScoreEl.textContent !== state.aiScore.toString()) {
      aiScoreEl.textContent = state.aiScore;
      aiScoreEl.classList.add("updated");
      setTimeout(() => aiScoreEl.classList.remove("updated"), 500);
    }
    
    comboEl.textContent = state.combo;
    if (state.combo >= 3) {
      comboEl.parentElement.classList.add("combo-display", "active");
    } else {
      comboEl.parentElement.classList.remove("active");
    }
    
    el.lives.textContent = state.lives;
    el.usedCount.textContent = state.used.size;
  }

  function isStationOnLine(lineKey, name) {
    const info = SUBWAY_DATA[lineKey];
    if (!info) return false;
    const norm = normalizeStation(name);
    const base = info.all.map(s => normalizeStation(s));
    return base.includes(norm);
  }

  function pickEnemy() {
    const enemyCfg = ENEMIES[state.difficulty];
    el.enemyAvatar.src = enemyCfg.img;
    el.enemyName.textContent = `âš™ ${enemyCfg.name} âš™`;
    el.enemyQuip.textContent = enemyCfg.quip;
    el.enemyDiff.textContent = `âš¡ ${enemyCfg.diff} âš¡`;
    if (state.difficulty === "easy") {
      el.enemyRole.textContent = "âš™ ê¸°ì–´ì™€ í†±ë‹ˆë¥¼ ë“±ì— ì§Šì–´ì§„ í•˜ìˆ˜ AI. ëŒ€í‘œì—­ ìœ„ì£¼ë¡œ ìƒëŒ€í•´ì¤ë‹ˆë‹¤.";
    } else if (state.difficulty === "normal") {
      el.enemyRole.textContent = "âš¡ ì „ êµ¬ê°„ ì—­ì„ ë’¤ì§€ëŠ” ì „ê¸° ê³ ì–‘ì´. ì‹¤ìˆ˜ë¥¼ ê·¸ëƒ¥ ë„˜ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    } else if (state.difficulty === "hard") {
      el.enemyRole.textContent = "ğŸ”¥ í™˜ìŠ¹ì—­ì„ ì§‘ì–´ì‚¼í‚¤ëŠ” ì² ê°‘ ê³°. ì½¤ë³´ ë£°ì„ ì ê·¹ í™œìš©í•©ë‹ˆë‹¤.";
    } else {
      el.enemyRole.textContent = "ğŸ’€ ë…¸ì„  ì „ì²´ë¥¼ ê¸°ì–µí•˜ëŠ” ì¦ê¸° ë±€ ì—”ì§„. ì¸ì ‘ì—­ ê·œì¹™ìœ¼ë¡œ ë‹¹ì‹ ì„ ì••ë°•í•©ë‹ˆë‹¤.";
    }
  }


  function updateDifficultyInfo() {
    const cfg = DIFFICULTIES[state.difficulty];
    let html = "";
    if (state.difficulty === "easy") {
      html += "<li>âš™ ëª¨ë“  ì—­ ì…ë ¥ ê°€ëŠ¥</li>";
      html += "<li>â± ì‹œê°„ ì—¬ìœ : " + cfg.timeLimit + "ì´ˆ, ë„‰ë„‰í•œ ëª©ìˆ¨</li>";
      html += "<li>ğŸ’¡ íŒíŠ¸ ë²„íŠ¼ìœ¼ë¡œ ì´ˆì„±/í›„ë³´ ì—­ ì œê³µ</li>";
      html += "<li>ğŸ¤– AI ì •í™•ë„: " + (cfg.aiAccuracy * 100).toFixed(0) + "%</li>";
    } else if (state.difficulty === "normal") {
      html += "<li>âš¡ ëª¨ë“  ì—­ ì…ë ¥ ê°€ëŠ¥</li>";
      html += "<li>â± ì‹œê°„ ì œí•œ: " + cfg.timeLimit + "ì´ˆ</li>";
      html += "<li>ğŸ¤– AI ì •í™•ë„: " + (cfg.aiAccuracy * 100).toFixed(0) + "%</li>";
    } else if (state.difficulty === "hard") {
      html += "<li>ğŸ”¥ ëª¨ë“  ì—­ ì…ë ¥ ê°€ëŠ¥</li>";
      html += "<li>âš¡ í™˜ìŠ¹ì—­ ì…ë ¥ ì‹œ ë³´ë„ˆìŠ¤ ì ìˆ˜</li>";
      html += "<li>â± ì‹œê°„ ì œí•œ: " + cfg.timeLimit + "ì´ˆ</li>";
      html += "<li>ğŸ¤– AI ì •í™•ë„: " + (cfg.aiAccuracy * 100).toFixed(0) + "%</li>";
    } else {
      html += "<li>ğŸ’€ ëª¨ë“  ì—­ ì…ë ¥ ê°€ëŠ¥</li>";
      html += "<li>âš¡ í™˜ìŠ¹ì—­ ì…ë ¥ ì‹œ ë³´ë„ˆìŠ¤ ì ìˆ˜</li>";
      html += "<li>â± ì‹œê°„ ì œí•œ: " + cfg.timeLimit + "ì´ˆ</li>";
      html += "<li>ğŸ¤– AI ì •í™•ë„: " + (cfg.aiAccuracy * 100).toFixed(0) + "%</li>";
    }
    el.difficultyInfoList.innerHTML = html;
  }

  function validateStation(name) {
    if (!name || typeof name !== 'string') {
      return { valid: false, reason: "ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." };
    }
    
    const trimmed = name.trim();
    if (trimmed === "") {
      return { valid: false, reason: "ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." };
    }
    
    const norm = normalizeStation(trimmed);
    if (norm === "") {
      return { valid: false, reason: "ì˜¬ë°”ë¥¸ ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." };
    }
    
    const cfg = DIFFICULTIES[state.difficulty];
    const info = SUBWAY_DATA[state.line];
    
    if (!info) {
      return { valid: false, reason: "í˜¸ì„  ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." };
    }
    
    // ëª¨ë“  ë‚œì´ë„ì—ì„œ ì „ì²´ ì—­ ëª©ë¡ ì‚¬ìš©
    const stationList = info.all;
    const normalizedList = stationList.map(s => normalizeStation(s));
    
    // ë””ë²„ê¹…: ì—­ ëª©ë¡ í™•ì¸
    if (!normalizedList.includes(norm)) {
      // ì •í™•í•œ ë§¤ì¹­ì„ ìœ„í•´ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸
      const exactMatch = stationList.find(s => normalizeStation(s) === norm);
      if (!exactMatch) {
        // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
        console.log("ì—­ ê²€ì¦ ì‹¤íŒ¨:", {
          ì…ë ¥: trimmed,
          ì •ê·œí™”: norm,
          í˜¸ì„ : info.name,
          ì‚¬ìš©ê°€ëŠ¥ì—­ìˆ˜: stationList.length,
          ì •ê·œí™”ëœëª©ë¡: normalizedList.slice(0, 20)
        });
        return { valid: false, reason: `${info.name}ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì—­ì…ë‹ˆë‹¤. (ì…ë ¥: "${trimmed}")` };
      }
    }
    
    if (state.used.has(norm)) {
      return { valid: false, reason: "ì´ë¯¸ ì‚¬ìš©í•œ ì—­ì…ë‹ˆë‹¤." };
    }
    
    // íƒ€ì„ì–´íƒ ëª¨ë“œì—ì„œëŠ” ê°™ì€ ì—­ ì—°ì† ì…ë ¥ í—ˆìš© (ë¹ ë¥¸ ì…ë ¥ì„ ìœ„í•´)
    
    return { valid: true, station: trimmed, normalized: norm };
  }

  function handleSubmit() {
    if (state.turn !== "player") {
      log("sys", "âš ï¸ ì•„ì§ ë‹¹ì‹ ì˜ í„´ì´ ì•„ë‹™ë‹ˆë‹¤!");
      return;
    }
    
    if (!el.stationInput || !el.stationInput.value) {
      log("sys", "âš ï¸ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
      return;
    }
    
    const input = el.stationInput.value;
    const result = validateStation(input);
    
    if (!result.valid) {
      el.submitBtn.classList.add("btn-error");
      setTimeout(() => el.submitBtn.classList.remove("btn-error"), 500);
      const errorMessages = [
        `âŒ ${result.reason}`,
        `ğŸ’€ ${result.reason} ëª©ìˆ¨ì´ ê°ì†Œí•©ë‹ˆë‹¤!`,
        `âš ï¸ ${result.reason} ì¡°ì‹¬í•˜ì„¸ìš”!`
      ];
      log("sys", errorMessages[Math.floor(Math.random() * errorMessages.length)]);
      state.lives--;
      state.combo = 0;
      updateStats();
      if (state.lives <= 0) {
        endGame(false);
        return;
      }
      el.statusLabel.textContent = `ğŸ’€ ëª©ìˆ¨ ${state.lives}ê°œ ë‚¨ìŒ! ì§‘ì¤‘í•˜ì„¸ìš”!`;
      return;
    }
    
    state.used.add(result.normalized);
    state.lastStation = result.station;
    state.playerScore++;
    state.combo++;
    
    if (state.combo === 3) {
      log("sys", "ğŸ”¥ 3ì½¤ë³´ ë‹¬ì„±! ë³´ë„ˆìŠ¤ ì ìˆ˜ +1!");
      state.playerScore++;
    } else if (state.combo === 5) {
      log("sys", "âš¡ 5ì½¤ë³´ ë‹¬ì„±! ëŒ€ë‹¨í•©ë‹ˆë‹¤! ë³´ë„ˆìŠ¤ ì ìˆ˜ +2!");
      state.playerScore += 2;
    } else if (state.combo === 10) {
      log("sys", "ğŸ‰ 10ì½¤ë³´ ë‹¬ì„±! ì „ì„¤ì ì¸ í”Œë ˆì´! ë³´ë„ˆìŠ¤ ì ìˆ˜ +5!");
      state.playerScore += 5;
    }
    
    const isTransfer = STATION_LINES[result.normalized] && STATION_LINES[result.normalized].size > 1;
    if (isTransfer && DIFFICULTIES[state.difficulty].comboTransfers) {
      state.playerScore += 2;
      log("player", `ğŸ”¥ ${result.station} âš¡ í™˜ìŠ¹ì—­ ë³´ë„ˆìŠ¤! +2ì  íšë“! ğŸ”¥`);
      const entry = el.logWindow.lastElementChild;
      if (entry) entry.classList.add("combo");
      el.statusLabel.textContent = "âš¡ í™˜ìŠ¹ì—­ ì½¤ë³´! ëŒ€ë‹¨í•©ë‹ˆë‹¤!";
    } else if (state.combo >= 5) {
      log("player", `âš¡ ${result.station} ğŸ”¥ ${state.combo}ì½¤ë³´ ë‹¬ì„±!`);
      el.statusLabel.textContent = `ğŸ”¥ ${state.combo}ì½¤ë³´! ê³„ì† ì´ì–´ê°€ì„¸ìš”!`;
    } else {
      log("player", `âœ… ${result.station}`);
      el.statusLabel.textContent = "ì¢‹ìŠµë‹ˆë‹¤! ê³„ì† ì´ì–´ê°€ì„¸ìš”!";
    }
    
    el.stationInput.value = "";
    el.submitBtn.classList.add("btn-success");
    setTimeout(() => el.submitBtn.classList.remove("btn-success"), 500);
    
    updateStats();
    resetTimer();
    
    setTimeout(() => {
      state.turn = "ai";
      aiTurn();
    }, 1000);
  }

  function aiTurn() {
    if (state.turn !== "ai") return;
    
    const cfg = DIFFICULTIES[state.difficulty];
    const info = SUBWAY_DATA[state.line];
    // ëª¨ë“  ë‚œì´ë„ì—ì„œ ì „ì²´ ì—­ ëª©ë¡ ì‚¬ìš©
    const stationList = info.all;
    const available = stationList.filter(s => {
      const norm = normalizeStation(s);
      if (state.used.has(norm)) return false;
      return true;
    });
    
    if (available.length === 0) {
      log("ai", "ğŸ¤– íŒ¨ë°°... ë” ì´ìƒ ì‚¬ìš©í•  ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
      endGame(true);
      return;
    }
    
    let chosen;
    if (Math.random() < cfg.aiAccuracy) {
      if (cfg.comboTransfers) {
        const transfers = available.filter(s => {
          const norm = normalizeStation(s);
          return STATION_LINES[norm] && STATION_LINES[norm].size > 1;
        });
        if (transfers.length > 0 && Math.random() < 0.6) {
          chosen = transfers[Math.floor(Math.random() * transfers.length)];
        } else {
          chosen = available[Math.floor(Math.random() * available.length)];
        }
      } else {
        chosen = available[Math.floor(Math.random() * available.length)];
      }
    } else {
      const wrong = stationList.filter(s => !state.used.has(normalizeStation(s)));
      chosen = wrong[Math.floor(Math.random() * wrong.length)] || available[0];
    }
    
    const norm = normalizeStation(chosen);
    state.used.add(norm);
    state.lastStation = chosen;
    state.aiScore++;
    
    const isTransfer = STATION_LINES[norm] && STATION_LINES[norm].size > 1;
    if (isTransfer && cfg.comboTransfers) {
      state.aiScore += 2;
      log("ai", `âš™ï¸ ${chosen} ğŸ”¥ AIê°€ í™˜ìŠ¹ì—­ ë³´ë„ˆìŠ¤ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);
      const entry = el.logWindow.lastElementChild;
      if (entry) entry.classList.add("combo");
    } else {
      const quips = [
        `âš™ï¸ ${chosen}`,
        `ğŸ¤– ${chosen} (AI í„´)`,
        `âš¡ ${chosen} (ê¸°ê³„ì˜ ì„ íƒ)`
      ];
      log("ai", quips[Math.floor(Math.random() * quips.length)]);
    }
    
    updateStats();
    resetTimer();
    
    setTimeout(() => {
      state.turn = "player";
      el.statusLabel.textContent = "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!";
    }, 1500);
  }

  function handleTimeout() {
    if (state.turn === "player") {
      log("sys", "â° ì‹œê°„ ì´ˆê³¼! ğŸ’€ ëª©ìˆ¨ì´ 1ê°œ ê°ì†Œí–ˆìŠµë‹ˆë‹¤...");
      state.lives--;
      updateStats();
      if (state.lives <= 0) {
        endGame(false);
        return;
      }
      log("sys", `ğŸ’ª ë‚¨ì€ ëª©ìˆ¨: ${state.lives}ê°œ! ë‹¤ì‹œ ì§‘ì¤‘í•˜ì„¸ìš”!`);
      state.turn = "ai";
      setTimeout(aiTurn, 500);
    }
  }

  function endGame(playerWon) {
    if (state.timerId) clearInterval(state.timerId);
    if (playerWon) {
      log("sys", `ğŸ‰ğŸ‰ğŸ‰ ìŠ¹ë¦¬! ğŸ‰ğŸ‰ğŸ‰`);
      log("sys", `âš¡ ìµœì¢… ì ìˆ˜: í”Œë ˆì´ì–´ ${state.playerScore} vs AI ${state.aiScore}`);
      log("sys", `ğŸ”¥ ìµœëŒ€ ì½¤ë³´: ${state.combo}ì½¤ë³´!`);
      el.statusLabel.textContent = "ğŸ‰ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤! ìŠ¤íŒ€í‘í¬ AIë¥¼ ë¬¼ë¦¬ì³¤ìŠµë‹ˆë‹¤!";
      el.statusLabel.style.color = "var(--accent-safe)";
      el.statusLabel.style.textShadow = "0 0 15px rgba(102,255,204,0.8)";
    } else {
      log("sys", `ğŸ’€ íŒ¨ë°°... ê¸°ê³„ì—ê²Œ ë‹¹í–ˆìŠµë‹ˆë‹¤...`);
      log("sys", `âš¡ ìµœì¢… ì ìˆ˜: í”Œë ˆì´ì–´ ${state.playerScore} vs AI ${state.aiScore}`);
      log("sys", `ğŸ’ª ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!`);
      el.statusLabel.textContent = "ğŸ’€ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤... ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!";
      el.statusLabel.style.color = "var(--accent-danger)";
      el.statusLabel.style.textShadow = "0 0 15px rgba(255,77,77,0.8)";
    }
    state.turn = "ended";
  }

  function resetGame() {
    if (state.timerId) clearInterval(state.timerId);
    state.turn = "player";
    state.used.clear();
    state.lastStation = null;
    state.playerScore = 0;
    state.aiScore = 0;
    state.combo = 0;
    const cfg = DIFFICULTIES[state.difficulty];
    state.lives = cfg.lives;
    state.timeLeft = cfg.timeLimit;
    state.chainLineLock = null;
    
    el.logWindow.innerHTML = "";
    el.stationInput.value = "";
    el.statusLabel.textContent = "âš™ï¸ ê²Œì„ ì‹œì‘! ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!";
    el.statusLabel.style.color = "";
    el.statusLabel.style.textShadow = "";
    updateStats();
    updateTimerUI();
    log("sys", "ğŸ® " + SUBWAY_DATA[state.line].name + " íƒ€ì„ì–´íƒ ê²Œì„ ì‹œì‘!");
    log("sys", "âš¡ " + ENEMIES[state.difficulty].name + "ì™€ì˜ ëŒ€ê²°ì…ë‹ˆë‹¤!");
    log("sys", "ğŸ’¡ íŒíŠ¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
  }

  function showHint() {
    const cfg = DIFFICULTIES[state.difficulty];
    if (!cfg.enableHints) {
      log("sys", "âš ï¸ ì´ ë‚œì´ë„ì—ì„œëŠ” íŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ğŸ’€");
      return;
    }
    
    const info = SUBWAY_DATA[state.line];
    // ëª¨ë“  ë‚œì´ë„ì—ì„œ ì „ì²´ ì—­ ëª©ë¡ ì‚¬ìš©
    const stationList = info.all;
    const available = stationList.filter(s => !state.used.has(normalizeStation(s)));
    
    if (available.length === 0) {
      log("sys", "âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ì—­ì´ ì—†ìŠµë‹ˆë‹¤...");
      return;
    }
    
    const hint = available[Math.floor(Math.random() * available.length)];
    const firstChar = hint.charAt(0);
    const hints = [
      `ğŸ’¡ íŒíŠ¸: "${firstChar}"ë¡œ ì‹œì‘í•˜ëŠ” ì—­ì´ ìˆìŠµë‹ˆë‹¤!`,
      `ğŸ” "${firstChar}"ë¡œ ì‹œì‘í•˜ëŠ” ì—­ì„ ì°¾ì•„ë³´ì„¸ìš”!`,
      `âš™ï¸ ê¸°ê³„ê°€ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤: "${firstChar}"ë¡œ ì‹œì‘í•˜ëŠ” ì—­ì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤!`
    ];
    log("sys", hints[Math.floor(Math.random() * hints.length)]);
  }

  /********************************************************************
   * DOM ìš”ì†Œ ì´ˆê¸°í™”
   ********************************************************************/
  function initDOM() {
    el = {
      lineSelect: document.getElementById("lineSelect"),
      difficultySelect: document.getElementById("difficultySelect"),
      modeTabs: document.querySelectorAll(".mode-tab"),
      logWindow: document.getElementById("logWindow"),
      stationInput: document.getElementById("stationInput"),
      submitBtn: document.getElementById("submitBtn"),
      hintBtn: document.getElementById("hintBtn"),
      timerBar: document.getElementById("timerBar"),
      timerText: document.getElementById("timerText"),
      turnText: document.getElementById("turnText"),
      statusLabel: document.getElementById("statusLabel"),
      panelTitleText: document.getElementById("panelTitleText"),
      playerScore: document.getElementById("playerScore"),
      aiScore: document.getElementById("aiScore"),
      comboCount: document.getElementById("comboCount"),
      lives: document.getElementById("lives"),
      usedCount: document.getElementById("usedCount"),
      hintText: document.getElementById("hintText"),
      resetGameBtn: document.getElementById("resetGameBtn"),
      enemyAvatar: document.getElementById("enemyAvatar"),
      enemyName: document.getElementById("enemyName"),
      enemyRole: document.getElementById("enemyRole"),
      enemyQuip: document.getElementById("enemyQuip"),
      enemyDiff: document.getElementById("enemyDiff"),
      difficultyInfoList: document.getElementById("difficultyInfoList")
    };
  }

  /********************************************************************
   * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
   ********************************************************************/
  function setupEventListeners() {
    if (!el.lineSelect || !el.difficultySelect || !el.submitBtn || !el.hintBtn || !el.resetGameBtn) {
      console.error("DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!", el);
      return;
    }

    el.lineSelect.addEventListener("change", () => {
      state.line = el.lineSelect.value;
      resetGame();
    });

    el.difficultySelect.addEventListener("change", () => {
      state.difficulty = el.difficultySelect.value;
      const cfg = DIFFICULTIES[state.difficulty];
      state.lives = cfg.lives;
      pickEnemy();
      updateDifficultyInfo();
      updateStats();
      resetGame();
    });

    el.modeTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        el.modeTabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        state.mode = tab.dataset.mode;
        el.panelTitleText.textContent = tab.textContent + " ëª¨ë“œ ì§„í–‰ì¤‘";
        resetGame();
      });
    });

    el.submitBtn.addEventListener("click", handleSubmit);
    el.stationInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") handleSubmit();
    });

    el.hintBtn.addEventListener("click", showHint);
    el.resetGameBtn.addEventListener("click", resetGame);
  }

  /********************************************************************
   * ì´ˆê¸°í™”
   ********************************************************************/
  function initGame() {
    pickEnemy();
    updateDifficultyInfo();
    updateStats();
    resetGame();
  }

  // DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initDOM();
      setupEventListeners();
      initGame();
    });
  } else {
    // ì´ë¯¸ ë¡œë“œëœ ê²½ìš°
    initDOM();
    setupEventListeners();
    initGame();
  }
</script>
</body>
</html>
